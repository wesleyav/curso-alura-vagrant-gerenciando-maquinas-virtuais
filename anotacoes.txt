# Configuração de Vagrant em máquina Windows

# Download do VirtualBox 6.0.4
# https://download.virtualbox.org/virtualbox/6.0.4/VirtualBox-6.0.4-128413-Win.exe

# Download do Vagrant
# https://releases.hashicorp.com/vagrant/2.2.3/vagrant_2.2.3_x86_64.msi

# Após instalação, verificar no prompt se está ok e versão instalada com:
$ vagrant version

# Dentro da pasta do projeto criar inicialização:
$ vagrant init hashicorp/precise64

# Subir máquina virtual (pode ser necessário habilitar Hyper-v no Windows)
$ vagrant up
# Aqui vai baixar alguns arquivos e subir o ambiente

# Verificar status
$ vagrant status

# Desligar vm
$ vagrant halt

# Visualizar configurações ssh
$ vagrant ssh-config

# Conectar em porta do ssh
$ vagrant -p 222 vagrant@127.0.0.1
# user vagrant / senha vagrant

#################################################

# Acessando o ubuntu (no caso), atualize os pacotes com:
$ sudo apt-get update

# Instalar o nginx
$ sudo apt-get install -y nginx

# Visualizar portas
$ netstat -lntp

# Testar o nginx via terminal:
$ curl http://localhost

# Adicionar a linha de configuração de Forward para a VM no arquivo Vagrantfile:
$ config.vm.network "forwarded_port", guest: 80, host: 8080

# Reiniciar a VM com:
$ vagrant halt
$ vagrant up

# Acessar pelo navegador o caminho do servidor Nginx:
# localhost:8080 (inserir o ip definido no Vagrantfile

# Adicionar IP Estático
# Adicionar a linha de configuração de Forward para a VM no arquivo Vagrantfile:
$ config.vm.network "private_network", ip: "192.168.50.4"

# Recarregar VM
$ vagrant reload (nem sempre funciona)

#################################################

# Apagar a VM (forçado)
$ vagrant destroy -f

# Configurar DHCP
# Alterar a linha de configuração de Forward para a VM no arquivo Vagrantfile:
$ config.vm.network "private_network", type: "dhcp"

# Instalar Nginx
$ sudo apt-get update && sudo apt-get install -y nginx

#################################################

# Configurar IP Público (modo bridge)
# Alterar a linha de configuração de Forward para a VM no arquivo Vagrantfile:
$ config.vm.network "public_network"

#################################################

# Criar par de chaves
$ ssh-keygen -t rsa

# Inserir o local onde será salvo a chave: 
# Inserir senha caso necessário

# Acessar VM via SSH e copiar chave para VM:

# Listar arquivos em pasta compartilhada
$ ls /vagrant/

# Copiar chave 
$ cp /vagrant/id_bionic.pub .

# Imprimir o conteúdo do arquivo
$ cat id_bionic.pub

# Adicionar chave ao arquivo .ssh/authorized_keys
$ cat id_bionic.pub >> .ssh/authorized_keys

# Exibir o conteúdo de .ssh/authorized_keys
$ cat .ssh/authorized_keys

# Conectar via SSH na VM usando a chave criada e importada
$ ssh -i id_bionic vagrant@192.168.0.7



